import*as Utils from"../../utils.js";export class Candidate{constructor({column_index:t,row_index:i,first_part_index:n,end_part_index:s,first_part_first_unit_index:e,last_part_end_unit_index:_}){0,0,0,0,0,0,this.column_index=t,this.row_index=i,this.first_part_index=n,this.end_part_index=s,this.first_part_first_unit_index=e,this.last_part_end_unit_index=_}Copy(){return new Candidate({column_index:this.column_index,row_index:this.row_index,first_part_index:this.first_part_index,end_part_index:this.end_part_index,first_part_first_unit_index:this.first_part_first_unit_index,last_part_end_unit_index:this.last_part_end_unit_index})}Column_Index(){return this.column_index}Row_Index(){return this.row_index}First_Part_Index(){return this.first_part_index}Last_Part_Index(){return this.end_part_index-1}End_Part_Index(){return this.end_part_index}First_Part_First_Unit_Index(){return this.first_part_first_unit_index}Last_Part_End_Unit_Index(){return this.last_part_end_unit_index}Is_Equal_To(t){return t.column_index===this.column_index&&t.row_index===this.row_index&&t.first_part_index===this.first_part_index&&t.end_part_index===this.end_part_index&&t.first_part_first_unit_index===this.first_part_first_unit_index&&t.last_part_end_unit_index===this.last_part_end_unit_index}Includes(t){return t.column_index===this.column_index&&t.row_index===this.row_index&&t.first_part_index>=this.first_part_index&&t.end_part_index<=this.end_part_index&&t.first_part_first_unit_index>=this.first_part_first_unit_index&&t.last_part_end_unit_index<=this.last_part_end_unit_index}Shadows(t){return t.column_index===this.column_index&&t.row_index===this.row_index&&t.first_part_index>=this.first_part_index&&t.end_part_index<this.end_part_index||t.first_part_index>this.first_part_index&&t.end_part_index<=this.end_part_index||t.first_part_index===this.first_part_index&&t.end_part_index===this.end_part_index&&(t.first_part_first_unit_index>=this.first_part_first_unit_index&&t.last_part_end_unit_index<this.last_part_end_unit_index||t.first_part_first_unit_index>this.first_part_first_unit_index&&t.last_part_end_unit_index<=this.last_part_end_unit_index)}}export class Runner{constructor(t){this.line=t,this.candidates=[],this.matches=[],this.buffer=[]}Copy(){const t=new Runner(this.line);for(const i of this.candidates)t.candidates.push(i.Copy());for(const i of this.matches)t.matches.push(i.Copy());return t}Combine(t){for(let i=0,n=t.Candidate_Count();i<n;i+=1)this.Try_Add_Candidate(t.Candidate(i));t.candidates=[];for(let i=0,n=t.Match_Count();i<n;i+=1)this.Try_Add_Match(t.Match(i));return t.matches=[],this}Line(){return this.line}Candidate_Count(){return this.candidates.length}Candidate(t){return 0,0,this.candidates[t]}Has_Candidate_Equal_To(t){for(const i of this.candidates)if(i.Is_Equal_To(t))return!0;return!1}Try_Add_Candidate(t){let i=!0;for(const n of this.candidates)n.Includes(t)?(i=!1,this.buffer.push(n)):t.Shadows(n)||this.buffer.push(n);const n=this.buffer;this.buffer=this.candidates,this.candidates=n,this.buffer.splice(0,this.buffer.length),i&&this.candidates.push(t)}Clear_Candidates(){this.candidates.splice(0,this.candidates.length)}Match_Count(){return this.matches.length}Match(t){return 0,0,this.matches[t]}Has_Match_Equal_To(t){for(const i of this.matches)if(i.Is_Equal_To(t))return!0;return!1}Try_Add_Match(t){let i=!0;for(const n of this.matches)n.Includes(t)?(i=!1,this.buffer.push(n)):t.Shadows(n)||this.buffer.push(n);const n=this.buffer;this.buffer=this.matches,this.matches=n,this.buffer.splice(0,this.buffer.length),i&&this.matches.push(t)}}export class Match{constructor({first_part_index:t,end_part_index:i,first_part_first_unit_index:n,last_part_end_unit_index:s}){0,0,0,0,this.first_part_index=t,this.end_part_index=i,this.first_part_first_unit_index=n,this.last_part_end_unit_index=s}First_Part_Index(){return this.first_part_index}Last_Part_Index(){return this.end_part_index-1}End_Part_Index(){return this.end_part_index}First_Part_First_Unit_Index(){return this.first_part_first_unit_index}Last_Part_End_Unit_Index(){return this.last_part_end_unit_index}}export class Instance{constructor(t){this.line=t.Line(),this.total_match_count=t.Match_Count(),this.matches={};for(let i=0,n=t.Match_Count();i<n;i+=1){const n=t.Match(i),s=n.Column_Index(),e=n.Row_Index();null==this.matches[s]&&(this.matches[s]={}),null==this.matches[s][e]&&(this.matches[s][e]=[]),this.matches[s][e].push(new Match({first_part_index:n.First_Part_Index(),end_part_index:n.End_Part_Index(),first_part_first_unit_index:n.First_Part_First_Unit_Index(),last_part_end_unit_index:n.Last_Part_End_Unit_Index()}))}}Line(){return this.line}Column(t){return this.Line().Column(t)}Row(t,i){return this.Line().Column(t).Row(i)}Total_Match_Count(){return this.total_match_count}Match_Count(t,i){return null==this.matches[t]||null==this.matches[t][i]?0:this.matches[t][i].length}Match(t,i,n){return 0,0,0,this.matches[t][i][n]}Matches(t,i){return null==this.matches[t]||null==this.matches[t][i]?[]:Array.from(this.matches[t][i])}}