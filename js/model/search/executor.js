import*as Utils from"../../utils.js";import{Sequence_Type}from"./sequence_type.js";import*as Parser from"./parser.js";import*as Compiler from"./compiler.js";import*as Node from"./node.js";import*as Result from"./result.js";export var Mode;!function(t){t[t.INITIAL=0]="INITIAL",t[t.NOT=1]="NOT",t[t.CASE=2]="CASE",t[t.ALIGN=4]="ALIGN",t[t.META=8]="META",t[t.COMPLEX_SEQUENCE=16]="COMPLEX_SEQUENCE"}(Mode||(Mode={}));export class Instance{constructor(){this.parser=new Parser.Instance,this.compiler=new Compiler.Instance}Parser(){return this.parser}Compiler(){return this.compiler}Tokens_Or_Help(t,e){return this.Parser().Parse(e,t)}Node_Or_Help(t,e){const n=this.parser.Parse(e,t);return n instanceof Parser.Help?n:this.Compiler().Compile(n)}Execute(t,e){const n=this.Tokens_Or_Help(t.Dictionary(),e);return n instanceof Parser.Help?n:this.Execute_With_Tokens(t,n)}Execute_With_Tokens(t,e){const n=this.Compiler().Compile(e);return this.Execute_With_Node(t,n)}Execute_With_Node(t,e){const n=[];for(let _=0,r=t.Line_Count();_<r;_+=1){const r=t.Line(_),d=this.Step(e,Mode.INITIAL,new Result.Runner(r));null!=d&&n.push(new Result.Instance(d))}return n}Step(t,e,n){const _=t.Type();if(_===Node.Type.MAYBE_ONE||_===Node.Type.MAYBE_MANY||_===Node.Type.ONE_OR_MANY){const _=t,r=this.Step(_.Operand(),e,n.Copy());return null!=r?r:this.Step(_.Next(),e,n.Copy())}if(_===Node.Type.SEQUENCE){const _=t,r=_.Sequence_Type(),d=this.Step(_.Operand(),r===Sequence_Type.COMPLEX?e|Mode.COMPLEX_SEQUENCE:e,new Result.Runner(n.Line()));return null!=d?(d.Clear_Candidates(),r===Sequence_Type.COMPLEX?d.Match_Count()>0?this.Step(_.Next(),e,n.Combine(d)):null:this.Step(_.Next(),e,n.Combine(d))):null}if(_===Node.Type.NOT){const _=t,r=this.Step(_.Operand(),e^Mode.NOT,n);return null!=r?this.Step(_.Next(),e,r):null}if(_===Node.Type.CASE){const _=t,r=this.Step(_.Operand(),e^Mode.CASE,n);return null!=r?this.Step(_.Next(),e,r):null}if(_===Node.Type.ALIGN){const _=t,r=this.Step(_.Operand(),e^Mode.ALIGN,n);return null!=r?this.Step(_.Next(),e,r):null}if(_===Node.Type.META){const _=t,r=this.Step(_.Operand(),e^Mode.META,n);return null!=r?this.Step(_.Next(),e,r):null}if(_===Node.Type.XOR){if(e&Mode.NOT)return Mode.COMPLEX_SEQUENCE,0,null;{const _=t,r=this.Step(_.Left_Operand(),e,n.Copy()),d=this.Step(_.Right_Operand(),e,n.Copy());return null!=r?null!=d?null:r:null!=d?d:null}}if(_===Node.Type.OR){const _=t;if(e&Mode.NOT){if(e&Mode.COMPLEX_SEQUENCE){const t=this.Step(_.Left_Operand(),e,n.Copy()),r=this.Step(_.Right_Operand(),e,n.Copy());if(null!=t&&null!=r){const e=new Result.Runner(n.Line());for(let n=0,_=t.Candidate_Count();n<_;n+=1)r.Has_Candidate_Equal_To(t.Candidate(n))&&e.Try_Add_Candidate(t.Candidate(n));for(let n=0,_=t.Match_Count();n<_;n+=1)r.Has_Match_Equal_To(t.Match(n))&&e.Try_Add_Match(t.Match(n));return e}return null}return null!=this.Step(_.Left_Operand(),e,n)?this.Step(_.Right_Operand(),e,n):null}{const t=this.Step(_.Left_Operand(),e,n.Copy()),r=this.Step(_.Right_Operand(),e,n.Copy());return null!=t?null!=r?t.Combine(r):t:null!=r?r:null}}return _===Node.Type.CLASS?e&Mode.COMPLEX_SEQUENCE?this.Complex_Class(t,e,n):this.Class(t,e,n):_===Node.Type.TEXT?e&Mode.COMPLEX_SEQUENCE?this.Complex_Text(t,e,n):this.Text(t,e,n):_===Node.Type.END?n:(0,null)}Text(t,e,n){const _=[];for(;!(t instanceof Node.End);)_.push(t),t=t.Next();let r;if(1===_.length)r=this.Text_Any(_[0],e,n);else{r=this.Text_Start(_[0],e,n);for(let t=1,n=_.length-1;t<n&&null!=r;t+=1)r=this.Text_Middle(_[t],e,r);null!=r&&(r=this.Text_End(_[_.length-1],e,r))}return null!=r?this.Step(t,e,r):null}Text_Any(t,e,n){0;const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,n=_.Column_Count();t<n;t+=1){const n=_.Column(t);for(let _=0,r=n.Row_Count();_<r;_+=1){const r=n.Row(_);for(let n=0,i=r.Macro_Part_Count();n<i;n+=1){const i=r.Macro_Part(n);if(e&Mode.META||!i.Is_Command_Or_Argument()){const r=e&Mode.CASE?i.Value():i.Value().toLowerCase();if(e&Mode.ALIGN)r===d&&a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length}));else for(let e=0,i=r.length-(d.length-1);e<i;e+=1)r.slice(e,e+d.length)===d&&a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:e,last_part_end_unit_index:e+d.length}))}}}}return e&Mode.NOT?a.Match_Count()>0?null:a:a.Match_Count()>0?a:null}Text_Start(t,e,n){0;const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,n=_.Column_Count();t<n;t+=1){const n=_.Column(t);for(let _=0,r=n.Row_Count();_<r;_+=1){const r=n.Row(_);for(let n=0,i=r.Macro_Part_Count();n<i;n+=1){const i=r.Macro_Part(n);if(e&Mode.META||!i.Is_Command_Or_Argument()){const r=e&Mode.CASE?i.Value():i.Value().toLowerCase();e&Mode.ALIGN?r===d&&a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length})):r.length>=d.length&&r.slice(r.length-d.length,r.length)===d&&a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:r.length-d.length,last_part_end_unit_index:r.length}))}}}}return e&Mode.NOT||a.Match_Count()>0?a:null}Text_Middle(t,e,n){const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,r=n.Match_Count();t<r;t+=1){const r=n.Match(t),i=_.Column(r.Column_Index()).Row(r.Row_Index()),o=r.End_Part_Index(),s=i.Macro_Part(o-1),l=e&Mode.CASE?s.Value():s.Value().toLowerCase();if(r.Last_Part_End_Unit_Index()===l.length){const t=i.Macro_Part_Count();let n=0;if(!(e&Mode.META))for(;o+n<t&&i.Macro_Part(o+n).Is_Command_Or_Argument();)n+=1;if(o+n<t){const t=i.Macro_Part(o+n),_=e&Mode.CASE?t.Value():t.Value().toLowerCase();_===d&&a.Try_Add_Match(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:_.length}))}}}return e&Mode.NOT||a.Match_Count()>0?a:null}Text_End(t,e,n){const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,r=n.Match_Count();t<r;t+=1){const r=n.Match(t),i=_.Column(r.Column_Index()).Row(r.Row_Index()),o=r.End_Part_Index(),s=i.Macro_Part(o-1),l=e&Mode.CASE?s.Value():s.Value().toLowerCase();if(r.Last_Part_End_Unit_Index()===l.length){const t=i.Macro_Part_Count();let n=0;if(!(e&Mode.META))for(;o+n<t&&i.Macro_Part(o+n).Is_Command_Or_Argument();)n+=1;if(o+n<t){const t=i.Macro_Part(o+n),_=e&Mode.CASE?t.Value():t.Value().toLowerCase();e&Mode.ALIGN?_===d&&a.Try_Add_Match(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:_.length})):_.length>=d.length&&_.slice(0,d.length)===d&&a.Try_Add_Match(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:d.length}))}}}return e&Mode.NOT?a.Match_Count()>0?null:a:a.Match_Count()>0?a:null}Complex_Text(t,e,n){const _=t;if(0===n.Candidate_Count()&&0===n.Match_Count()){const t=this.Complex_Text_Any(_,e,n),r=this.Complex_Text_Start(_,e,n);return null!=t?null!=r?this.Step(_.Next(),e,t.Combine(r)):this.Step(_.Next(),e,t):null!=r?this.Step(_.Next(),e,r):null}{const t=this.Complex_Text_Middle(_,e,n),r=this.Complex_Text_End(_,e,n);return null!=t?null!=r?this.Step(_.Next(),e,t.Combine(r)):this.Step(_.Next(),e,t):null!=r?this.Step(_.Next(),e,r):null}}Complex_Text_Any(t,e,n){0,0;const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,n=_.Column_Count();t<n;t+=1){const n=_.Column(t);for(let _=0,r=n.Row_Count();_<r;_+=1){const r=n.Row(_);for(let n=0,i=r.Macro_Part_Count();n<i;n+=1){const i=r.Macro_Part(n);if(e&Mode.META||!i.Is_Command_Or_Argument()){const r=e&Mode.CASE?i.Value():i.Value().toLowerCase();if(e&Mode.ALIGN)e&Mode.NOT?r!==d&&a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length})):r===d&&a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length}));else{const i=[];for(let t=0,e=r.length-(d.length-1);t<e;t+=1)r.slice(t,t+d.length)===d&&i.push(t);if(e&Mode.NOT)0===i.length&&a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length}));else for(const e of i)a.Try_Add_Match(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:e,last_part_end_unit_index:e+d.length}))}}}}}return a.Match_Count()>0?a:null}Complex_Text_Start(t,e,n){0,0;const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,n=_.Column_Count();t<n;t+=1){const n=_.Column(t);for(let _=0,r=n.Row_Count();_<r;_+=1){const r=n.Row(_);for(let n=0,i=r.Macro_Part_Count();n<i;n+=1){const i=r.Macro_Part(n);if(e&Mode.META||!i.Is_Command_Or_Argument()){const r=e&Mode.CASE?i.Value():i.Value().toLowerCase();e&Mode.ALIGN?e&Mode.NOT?r!==d&&a.Try_Add_Candidate(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length})):r===d&&a.Try_Add_Candidate(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length})):e&Mode.NOT?(r.length<d.length||r.slice(r.length-d.length,r.length)!==d)&&a.Try_Add_Candidate(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:0,last_part_end_unit_index:r.length})):r.length>=d.length&&r.slice(r.length-d.length,r.length)===d&&a.Try_Add_Candidate(new Result.Candidate({column_index:t,row_index:_,first_part_index:n,end_part_index:n+1,first_part_first_unit_index:r.length-d.length,last_part_end_unit_index:r.length}))}}}}return a.Candidate_Count()>0?a:null}Complex_Text_Middle(t,e,n){const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,r=n.Candidate_Count();t<r;t+=1){const r=n.Candidate(t),i=_.Column(r.Column_Index()).Row(r.Row_Index()),o=r.End_Part_Index(),s=i.Macro_Part(o-1),l=e&Mode.CASE?s.Value():s.Value().toLowerCase();if(r.Last_Part_End_Unit_Index()===l.length){const t=i.Macro_Part_Count();let n=0;if(!(e&Mode.META))for(;o+n<t&&i.Macro_Part(o+n).Is_Command_Or_Argument();)n+=1;if(o+n<t){const t=i.Macro_Part(o+n),_=e&Mode.CASE?t.Value():t.Value().toLowerCase();e&Mode.NOT?_!==d&&a.Try_Add_Candidate(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:_.length})):_===d&&a.Try_Add_Candidate(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:_.length}))}}}return a.Candidate_Count()>0?a:null}Complex_Text_End(t,e,n){const _=n.Line(),r=t.Part(),d=e&Mode.CASE?r.Value():r.Value().toLowerCase(),a=new Result.Runner(n.Line());for(let t=0,r=n.Candidate_Count();t<r;t+=1){const r=n.Candidate(t),i=_.Column(r.Column_Index()).Row(r.Row_Index()),o=r.End_Part_Index(),s=i.Macro_Part(o-1),l=e&Mode.CASE?s.Value():s.Value().toLowerCase();if(r.Last_Part_End_Unit_Index()===l.length){const t=i.Macro_Part_Count();let n=0;if(!(e&Mode.META))for(;o+n<t&&i.Macro_Part(o+n).Is_Command_Or_Argument();)n+=1;if(o+n<t){const t=i.Macro_Part(o+n),_=e&Mode.CASE?t.Value():t.Value().toLowerCase();e&Mode.ALIGN?e&Mode.NOT?_!==d&&a.Try_Add_Match(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:_.length})):_===d&&a.Try_Add_Match(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:_.length})):e&Mode.NOT?(_.length<d.length||_.slice(0,d.length)!==d)&&a.Try_Add_Match(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:_.length})):_.length>=d.length&&_.slice(0,d.length)===d&&a.Try_Add_Match(new Result.Candidate({column_index:r.Column_Index(),row_index:r.Row_Index(),first_part_index:r.First_Part_Index(),end_part_index:o+n+1,first_part_first_unit_index:r.First_Part_First_Unit_Index(),last_part_end_unit_index:d.length}))}}}return a.Match_Count()>0?a:null}Class(t,e,n){const _=t;if(0===n.Match_Count()){const t=this.Class_Any_Or_Start(_,e,n);return null!=t?this.Step(_.Next(),e,t):null}{const t=this.Class_Middle_Or_End(_,e,n);return null!=t?this.Step(_.Next(),e,t):null}}Class_Any_Or_Start(t,e,n){0;const _=n.Line(),r=new Result.Runner(n.Line());for(let n=0,d=_.Column_Count();n<d;n+=1){const d=_.Column(n);for(let _=0,a=d.Row_Count();_<a;_+=1){const a=d.Row(_);for(let d=0,i=a.Macro_Part_Count();d<i;d+=1){const i=a.Macro_Part(d);if(e&Mode.META||!i.Is_Command_Or_Argument()){const a=e&Mode.CASE?i.Value():i.Value().toLowerCase();t.Recognizes(i)&&r.Try_Add_Match(new Result.Candidate({column_index:n,row_index:_,first_part_index:d,end_part_index:d+1,first_part_first_unit_index:0,last_part_end_unit_index:a.length}))}}}}return e&Mode.NOT?r.Match_Count()>0?null:r:r.Match_Count()>0?r:null}Class_Middle_Or_End(t,e,n){const _=n.Line(),r=new Result.Runner(n.Line());for(let d=0,a=n.Match_Count();d<a;d+=1){const a=n.Match(d),i=_.Column(a.Column_Index()).Row(a.Row_Index()),o=a.End_Part_Index(),s=i.Macro_Part(o-1),l=e&Mode.CASE?s.Value():s.Value().toLowerCase();if(a.Last_Part_End_Unit_Index()===l.length){const n=i.Macro_Part_Count();let _=0;if(!(e&Mode.META))for(;o+_<n&&i.Macro_Part(o+_).Is_Command_Or_Argument();)_+=1;if(o+_<n){const n=i.Macro_Part(o+_),d=e&Mode.CASE?n.Value():n.Value().toLowerCase();t.Recognizes(n)&&r.Try_Add_Match(new Result.Candidate({column_index:a.Column_Index(),row_index:a.Row_Index(),first_part_index:a.First_Part_Index(),end_part_index:o+_+1,first_part_first_unit_index:a.First_Part_First_Unit_Index(),last_part_end_unit_index:d.length}))}}}return e&Mode.NOT?r.Match_Count()>0?null:r:r.Match_Count()>0?r:null}Complex_Class(t,e,n){const _=t;if(0===n.Candidate_Count()&&0===n.Match_Count()){const t=this.Complex_Class_Any(_,e,n),r=this.Complex_Class_Start(_,e,n);return null!=t?null!=r?this.Step(_.Next(),e,t.Combine(r)):this.Step(_.Next(),e,t):null!=r?this.Step(_.Next(),e,r):null}{const t=this.Complex_Class_Middle(_,e,n),r=this.Complex_Class_End(_,e,n);return null!=t?null!=r?this.Step(_.Next(),e,t.Combine(r)):this.Step(_.Next(),e,t):null!=r?this.Step(_.Next(),e,r):null}}Complex_Class_Any(t,e,n){0,0;const _=n.Line(),r=new Result.Runner(n.Line());for(let n=0,d=_.Column_Count();n<d;n+=1){const d=_.Column(n);for(let _=0,a=d.Row_Count();_<a;_+=1){const a=d.Row(_);for(let d=0,i=a.Macro_Part_Count();d<i;d+=1){const i=a.Macro_Part(d);if(e&Mode.META||!i.Is_Command_Or_Argument()){const a=e&Mode.CASE?i.Value():i.Value().toLowerCase();e&Mode.NOT?t.Recognizes(i)||r.Try_Add_Match(new Result.Candidate({column_index:n,row_index:_,first_part_index:d,end_part_index:d+1,first_part_first_unit_index:0,last_part_end_unit_index:a.length})):t.Recognizes(i)&&r.Try_Add_Match(new Result.Candidate({column_index:n,row_index:_,first_part_index:d,end_part_index:d+1,first_part_first_unit_index:0,last_part_end_unit_index:a.length}))}}}}return r.Match_Count()>0?r:null}Complex_Class_Start(t,e,n){0,0;const _=n.Line(),r=new Result.Runner(n.Line());for(let n=0,d=_.Column_Count();n<d;n+=1){const d=_.Column(n);for(let _=0,a=d.Row_Count();_<a;_+=1){const a=d.Row(_);for(let d=0,i=a.Macro_Part_Count();d<i;d+=1){const i=a.Macro_Part(d);if(e&Mode.META||!i.Is_Command_Or_Argument()){const a=e&Mode.CASE?i.Value():i.Value().toLowerCase();e&Mode.NOT?t.Recognizes(i)||r.Try_Add_Candidate(new Result.Candidate({column_index:n,row_index:_,first_part_index:d,end_part_index:d+1,first_part_first_unit_index:0,last_part_end_unit_index:a.length})):t.Recognizes(i)&&r.Try_Add_Candidate(new Result.Candidate({column_index:n,row_index:_,first_part_index:d,end_part_index:d+1,first_part_first_unit_index:0,last_part_end_unit_index:a.length}))}}}}return r.Candidate_Count()>0?r:null}Complex_Class_Middle(t,e,n){const _=n.Line(),r=new Result.Runner(n.Line());for(let d=0,a=n.Candidate_Count();d<a;d+=1){const a=n.Candidate(d),i=_.Column(a.Column_Index()).Row(a.Row_Index()),o=a.End_Part_Index(),s=i.Macro_Part(o-1),l=e&Mode.CASE?s.Value():s.Value().toLowerCase();if(a.Last_Part_End_Unit_Index()===l.length){const n=i.Macro_Part_Count();let _=0;if(!(e&Mode.META))for(;o+_<n&&i.Macro_Part(o+_).Is_Command_Or_Argument();)_+=1;if(o+_<n){const n=i.Macro_Part(o+_),d=e&Mode.CASE?n.Value():n.Value().toLowerCase();e&Mode.NOT?t.Recognizes(n)||r.Try_Add_Candidate(new Result.Candidate({column_index:a.Column_Index(),row_index:a.Row_Index(),first_part_index:a.First_Part_Index(),end_part_index:o+_+1,first_part_first_unit_index:a.First_Part_First_Unit_Index(),last_part_end_unit_index:d.length})):t.Recognizes(n)&&r.Try_Add_Candidate(new Result.Candidate({column_index:a.Column_Index(),row_index:a.Row_Index(),first_part_index:a.First_Part_Index(),end_part_index:o+_+1,first_part_first_unit_index:a.First_Part_First_Unit_Index(),last_part_end_unit_index:d.length}))}}}return r.Candidate_Count()>0?r:null}Complex_Class_End(t,e,n){const _=n.Line(),r=new Result.Runner(n.Line());for(let d=0,a=n.Candidate_Count();d<a;d+=1){const a=n.Candidate(d),i=_.Column(a.Column_Index()).Row(a.Row_Index()),o=a.End_Part_Index(),s=i.Macro_Part(o-1),l=e&Mode.CASE?s.Value():s.Value().toLowerCase();if(a.Last_Part_End_Unit_Index()===l.length){const n=i.Macro_Part_Count();let _=0;if(!(e&Mode.META))for(;o+_<n&&i.Macro_Part(o+_).Is_Command_Or_Argument();)_+=1;if(o+_<n){const n=i.Macro_Part(o+_),d=e&Mode.CASE?n.Value():n.Value().toLowerCase();e&Mode.NOT?t.Recognizes(n)||r.Try_Add_Match(new Result.Candidate({column_index:a.Column_Index(),row_index:a.Row_Index(),first_part_index:a.First_Part_Index(),end_part_index:o+_+1,first_part_first_unit_index:a.First_Part_First_Unit_Index(),last_part_end_unit_index:d.length})):t.Recognizes(n)&&r.Try_Add_Match(new Result.Candidate({column_index:a.Column_Index(),row_index:a.Row_Index(),first_part_index:a.First_Part_Index(),end_part_index:o+_+1,first_part_first_unit_index:a.First_Part_First_Unit_Index(),last_part_end_unit_index:d.length}))}}}return r.Match_Count()>0?r:null}}