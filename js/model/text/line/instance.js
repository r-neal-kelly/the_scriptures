import*as Utils from"../../../utils.js";import*as Unicode from"../../../unicode.js";import*as Language from"../../language.js";import*as Dictionary from"../dictionary.js";import*as Part from"../part.js";import*as Path from"../path.js";var Parse_Type;!function(t){t[t.WORD=0]="WORD",t[t.BREAK=1]="BREAK",t[t.POINT=2]="POINT"}(Parse_Type||(Parse_Type={}));class Error_Argument_Frame{constructor({parameter:t,argument:e,from_text:a,from_text_index:n}){this.first_non_command_index=Part.Command.First_Non_Command_Index(e),null!=this.first_non_command_index&&(this.first_non_command_index=n+Part.Command.Symbol.FIRST.length+t.length+Part.Command.Symbol.DIVIDER.length+this.first_non_command_index),this.last_non_command_index=Part.Command.Last_Non_Command_Index(e),null!=this.last_non_command_index&&(this.last_non_command_index=n+Part.Command.Symbol.FIRST.length+t.length+Part.Command.Symbol.DIVIDER.length+this.last_non_command_index),this.closing_command_index=Part.Command.Closing_Command_Index_From_Opening_Command(a)||-1,-1!==this.closing_command_index?this.closing_command_index=n+this.closing_command_index:this.closing_command_index=n+a.length}First_Non_Command_Index(){return this.first_non_command_index}Last_Non_Command_Index(){return this.last_non_command_index}Closing_Command_Index(){return this.closing_command_index}}export class Instance{constructor({text:t,index:e,value:a}){this.text=t,this.index=e,this.paths={},this.has_errorless_path=!1,this.Set_Value(a)}Text(){return this.text}Index(){return this.index}Value(){let t=this.Text().Path_Type();return this.paths.hasOwnProperty(t)||(t=Path.Type.DEFAULT),this.paths[t].Value()}Set_Value(t){0,this.paths={},this.has_errorless_path=!1,this.Set_Path(Path.Type.DEFAULT,t),this.has_errorless_path&&this.Set_Path(Path.Type.ERRORLESS,Part.Command.Resolve_Errors(t,!1))}Set_Path(t,e){const a=new Path.Instance({type:t,value:e});if(""===e)a.Update_Empty();else{const n=this.Text().Dictionary(),s=Part.Command.Partition_Into_Column_Rows(e);for(const r of s){const o=Part.Command.First_Non_Command_Index(r),_=Part.Command.Last_Non_Command_Index(r),m=[],l=[];let i=Parse_Type.POINT,d=Part.Style._NONE_,h=new Unicode.Iterator({text:r});function u(){return m.length>0?m[m.length-1]:null}function p(t,e){if(l.length>0){const a=l[l.length-1];return t.Index()===a.First_Non_Command_Index()&&(null==o||e.Index()<o)?Dictionary.Boundary.START:e.Index()===a.Last_Non_Command_Index()&&(null==_||a.Closing_Command_Index()>_)?Dictionary.Boundary.END:Dictionary.Boundary.MIDDLE}return t.Index()===o?Dictionary.Boundary.START:e.Index()===_?Dictionary.Boundary.END:Dictionary.Boundary.MIDDLE}for(let I=h;!I.Is_At_End();){const P=Part.Command.Maybe_Valid_Value_From(I.Points());if(null!=P){let g=P,x=u(),y=new Part.Command.Instance({index:0,value:g,language:null});y.Is_Open_Italic()?d|=Part.Style.ITALIC:y.Is_Close_Italic()?d&=~Part.Style.ITALIC:y.Is_Open_Bold()?d|=Part.Style.BOLD:y.Is_Close_Bold()?d&=~Part.Style.BOLD:y.Is_Open_Underline()?d|=Part.Style.UNDERLINE:y.Is_Close_Underline()?d&=~Part.Style.UNDERLINE:y.Is_Open_Small_Caps()?d|=Part.Style.SMALL_CAPS:y.Is_Close_Small_Caps()?d&=~Part.Style.SMALL_CAPS:y.Is_Open_Error()?(this.has_errorless_path=!0,y.Has_Argument()?(g=Part.Command.Symbol.FIRST+y.Some_Parameter()+Part.Command.Symbol.DIVIDER,l.push(new Error_Argument_Frame({parameter:y.Some_Parameter(),argument:y.Some_Argument(),from_text:I.Points(),from_text_index:I.Index()})),d|=Part.Style.ARGUMENT):d|=Part.Style.ERROR):y.Is_Close_Error()?d&=~Part.Style.ERROR:y.Is_Open_Hebrew()?m.push(Language.Name.HEBREW):y.Is_Open_Greek()?m.push(Language.Name.GREEK):y.Is_Open_Latin()?m.push(Language.Name.LATIN):y.Is_Open_Aramaic()?m.push(Language.Name.ARAMAIC):y.Is_Open_Arabic()?m.push(Language.Name.ARABIC):y.Is_Open_German()?m.push(Language.Name.GERMAN):y.Is_Open_French()?m.push(Language.Name.FRENCH):y.Is_Open_Italian()?m.push(Language.Name.ITALIAN):y.Is_Open_Dutch()?m.push(Language.Name.DUTCH):y.Is_Open_English()?m.push(Language.Name.ENGLISH):y.Is_Close_Language()&&(m.length>0&&m.pop(),x=u()),a.Update_Command(r,{value:g,language:x}),I=new Unicode.Iterator({text:I.Text(),index:I.Index()+g.length}),h=I}else if(l.length>0&&I.Point()===Part.Command.Symbol.LAST)l.pop(),0===l.length&&(d&=~Part.Style.ARGUMENT),d|=Part.Style.ERROR,a.Update_Command(r,{value:Part.Command.Symbol.LAST,language:u()}),I=I.Next(),h=I;else{const c=I.Point(),C=I.Look_Forward_Point(),T=Part.Command.Maybe_Valid_Value_From(I.Look_Forward_Points()||"");if(n.Has_Letter(c)?(a.Update_Letter(r,{value:c,style:d,language:u()}),i=Parse_Type.WORD):n.Has_Marker(c)?(a.Update_Marker(r,{value:c,style:d,language:u()}),i=Parse_Type.BREAK):(a.Update_Point(r,{value:c,style:d,language:u()}),i=Parse_Type.POINT,h=I.Next()),i===Parse_Type.WORD){if(null==C||null!=T||!n.Has_Letter(C)){const S=I.Text().slice(h.Index(),I.Look_Forward_Index()),N=n.Has_Word(S)?Part.Status.GOOD:n.Has_Word_Error(S)?Part.Status.ERROR:Part.Status.UNKNOWN;a.Update_Word(r,{value:S,status:N,style:d,language:u()}),h=I.Next()}}else if(i===Parse_Type.BREAK&&(null==C||null!=T||!n.Has_Marker(C))){const E=I.Text().slice(h.Index(),I.Look_Forward_Index()),L=p(h,I),R=n.Has_Break(E,L)?Part.Status.GOOD:n.Has_Break_Error(E,L)?Part.Status.ERROR:Part.Status.UNKNOWN;a.Update_Break(r,{value:E,status:R,style:d,language:u(),boundary:L}),h=I.Next()}I=I.Next()}}}}a.Finalize(),this.paths[t]=a}Has_Column_Index(t){0;let e=this.Text().Path_Type();return this.paths.hasOwnProperty(e)||(e=Path.Type.DEFAULT),this.paths[e].Has_Column_Index(t)}Column_Count(){let t=this.Text().Path_Type();return this.paths.hasOwnProperty(t)||(t=Path.Type.DEFAULT),this.paths[t].Column_Count()}Column(t){0;let e=this.Text().Path_Type();return this.paths.hasOwnProperty(e)||(e=Path.Type.DEFAULT),this.paths[e].Column(t)}}