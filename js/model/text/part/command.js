import*as Utils from"../../../utils.js";import*as Unicode from"../../../unicode.js";import*as Languages from"../../languages.js";import*as Part from"./instance.js";import{Type}from"./type.js";import{Status}from"./status.js";import{Style}from"./style.js";export var Symbol;var Parameter;!function(e){e.FIRST="⸨",e.LAST="⸩",e.CLOSE="/",e.DIVIDER=":"}(Symbol||(Symbol={})),function(e){e.ERROR="err",e.LANGUAGE="lang"}(Parameter||(Parameter={}));export var Known_Value;function Interior_Value(e){return e.replace(/^⸨\/?/,"").replace(/⸩$/,"")}function Interior_Parameter_And_Argument(e){const n=Interior_Value(e),t=n.indexOf(Symbol.DIVIDER),r=n.slice(0,t),a=n.slice(t+Symbol.DIVIDER.length);return r.length>0&&a.length>0?{parameter:r,argument:a}:null}!function(e){e.CENTER="⸨cen⸩",e.INDENT="⸨in⸩",e.OPEN_ITALIC="⸨i⸩",e.CLOSE_ITALIC="⸨/i⸩",e.OPEN_BOLD="⸨b⸩",e.CLOSE_BOLD="⸨/b⸩",e.OPEN_UNDERLINE="⸨u⸩",e.CLOSE_UNDERLINE="⸨/u⸩",e.OPEN_SMALL_CAPS="⸨sc⸩",e.CLOSE_SMALL_CAPS="⸨/sc⸩",e.OPEN_ERROR="⸨err⸩",e.CLOSE_ERROR="⸨/err⸩",e.OPEN_LEFT_TO_RIGHT="⸨ltr⸩",e.CLOSE_LEFT_TO_RIGHT="⸨/ltr⸩",e.OPEN_RIGHT_TO_LEFT="⸨rtl⸩",e.CLOSE_RIGHT_TO_LEFT="⸨/rtl⸩",e.CLOSE_LANGUAGE="⸨/lang⸩"}(Known_Value||(Known_Value={}));export function Is_Valid_Value(e){const n=Interior_Value(e);return e.length>2&&"⸨"===e[0]&&"⸩"===e[e.length-1]&&n.length>0&&!/⸨/.test(n)&&!/\//.test(n)&&!/\s/.test(n)&&!/⸩/.test(n)}export function Is_Known_Value(e){if(e===Known_Value.CENTER||e===Known_Value.INDENT||e===Known_Value.OPEN_ITALIC||e===Known_Value.CLOSE_ITALIC||e===Known_Value.OPEN_BOLD||e===Known_Value.CLOSE_BOLD||e===Known_Value.OPEN_UNDERLINE||e===Known_Value.CLOSE_UNDERLINE||e===Known_Value.OPEN_SMALL_CAPS||e===Known_Value.CLOSE_SMALL_CAPS||e===Known_Value.OPEN_ERROR||e===Known_Value.CLOSE_ERROR||e===Known_Value.OPEN_LEFT_TO_RIGHT||e===Known_Value.CLOSE_LEFT_TO_RIGHT||e===Known_Value.OPEN_RIGHT_TO_LEFT||e===Known_Value.CLOSE_RIGHT_TO_LEFT||e===Known_Value.CLOSE_LANGUAGE)return!0;{const n=Interior_Parameter_And_Argument(e);return null!=n&&(n.parameter===Parameter.LANGUAGE?n.argument===Languages.Name.ENGLISH||n.argument===Languages.Name.HEBREW||n.argument===Languages.Name.GREEK||n.argument===Languages.Name.LATIN:n.parameter===Parameter.ERROR)}}export function Maybe_Valid_Value_From(e){const n=e.match(/^⸨[^⸩]*⸩/);return null!=n?n[0]:null}export function Last_Non_Value_Index(e){if(e.length>0){const n=e.match(/(⸨[^⸩]*⸩)*$/);if(null!=n&&n[0].length>0){const t=new Unicode.Iterator({text:e,index:e.length-n[0].length});return t.Is_At_Start()?null:t.Previous().Index()}return new Unicode.Iterator({text:e,index:e.length}).Previous().Index()}return null}export class Instance extends Part.Instance{constructor({index:e,value:n}){super({part_type:Type.COMMAND,index:e,value:n,status:Is_Known_Value(n)?Status.GOOD:Is_Valid_Value(n)?Status.UNKNOWN:Status.ERROR,style:Style._NONE_,language:null}),Utils.Assert(n.length>=2,"A command must have a length of at least 2.");const t=Interior_Parameter_And_Argument(n);null!=t?(this.parameter=t.parameter,this.argument=t.argument):(this.parameter=null,this.argument=null)}Has_Parameter(){return null!=this.parameter}Parameter(){return this.parameter}Some_Parameter(){return Utils.Assert(this.Has_Parameter(),"doesn't have a parameter"),this.parameter}Has_Argument(){return null!=this.argument}Argument(){return this.argument}Some_Argument(){return Utils.Assert(this.Has_Argument(),"doesn't have an argument"),this.argument}Is_Center(){return this.Value()===Known_Value.CENTER}Is_Indent(){return this.Value()===Known_Value.INDENT}Is_Opening(){return"/"!==this.Value()[1]}Is_Closing(){return"/"===this.Value()[1]}Is_Open_Italic(){return this.Value()===Known_Value.OPEN_ITALIC}Is_Close_Italic(){return this.Value()===Known_Value.CLOSE_ITALIC}Is_Open_Bold(){return this.Value()===Known_Value.OPEN_BOLD}Is_Close_Bold(){return this.Value()===Known_Value.CLOSE_BOLD}Is_Open_Underline(){return this.Value()===Known_Value.OPEN_UNDERLINE}Is_Close_Underline(){return this.Value()===Known_Value.CLOSE_UNDERLINE}Is_Open_Small_Caps(){return this.Value()===Known_Value.OPEN_SMALL_CAPS}Is_Close_Small_Caps(){return this.Value()===Known_Value.CLOSE_SMALL_CAPS}Is_Open_Error(){return this.Value()===Known_Value.OPEN_ERROR||this.Parameter()===Parameter.ERROR}Is_Close_Error(){return this.Value()===Known_Value.CLOSE_ERROR}Is_Open_Left_To_Right(){return this.Value()===Known_Value.OPEN_LEFT_TO_RIGHT}Is_Close_Left_To_Right(){return this.Value()===Known_Value.CLOSE_LEFT_TO_RIGHT}Is_Open_Right_To_Left(){return this.Value()===Known_Value.OPEN_RIGHT_TO_LEFT}Is_Close_Right_To_Left(){return this.Value()===Known_Value.CLOSE_RIGHT_TO_LEFT}Is_Open_Language(){return this.Parameter()===Parameter.LANGUAGE}Is_Open_English(){return this.Parameter()===Parameter.LANGUAGE&&this.Argument()===Languages.Name.ENGLISH}Is_Open_Hebrew(){return this.Parameter()===Parameter.LANGUAGE&&this.Argument()===Languages.Name.HEBREW}Is_Open_Greek(){return this.Parameter()===Parameter.LANGUAGE&&this.Argument()===Languages.Name.GREEK}Is_Open_Latin(){return this.Parameter()===Parameter.LANGUAGE&&this.Argument()===Languages.Name.LATIN}Is_Close_Language(){return this.Value()===Known_Value.CLOSE_LANGUAGE}}