import*as Utils from"../../../utils.js";import*as Text from"../../text.js";import*as Text_Base from"../text_base.js";import*as Segment from"./segment.js";export class Instance extends Text_Base.Row.Instance{constructor({column:t,index:e,text:n}){if(super({column:t,index:e,text:n}),!this.Is_Blank())if(""===this.Text().Value()){const t=new Text.Segment.Instance({segment_type:Text.Segment.Type.MICRO,index:0});t.Add_Item(new Text.Part.Instance({part_type:Text.Part.Type.POINT,index:0,value:"Â ",status:Text.Part.Status.GOOD,style:Text.Part.Style._NONE_,language:null})),this.Push_Segment(new Segment.Instance({row:this,index:0,text:t}))}else{const t=this.Text();for(let e=0,n=t.Macro_Segment_Count();e<n;e+=1)this.Push_Segment(new Segment.Instance({row:this,index:e,text:t.Macro_Segment(e)}));const e=this.Result(),n=this.Column().Index(),i=this.Index();for(let s=0,_=e.Match_Count(n,i);s<_;s+=1){const _=e.Match(n,i,s),d=_.first_part_index,r=_.first_part_first_unit_index,l=_.last_part_end_unit_index,g=_.end_part_index-1;for(let e=d,n=_.end_part_index;e<n;e+=1){const n=t.Macro_Part_Segment_Item_Indices(e);if(e===d&&e===g){let e=!1;for(let i=0,s=n.length;i<s;i+=1){const{segment_index:_,item_index:d}=n[i],g=t.Macro_Segment(_).Item(d);if(g.Is_Part())0,this.Segment_At(_).Item_At(d).Highlight({first_unit_index:r,end_unit_index:l});else{const t=g,n=t.End_Unit_Index();if(e){if(l<=n){this.Segment_At(_).Item_At(d).Highlight({first_unit_index:0,end_unit_index:l-t.First_Unit_Index()});break}this.Segment_At(_).Item_At(d).Highlight({first_unit_index:0,end_unit_index:t.Value().length})}else if(r<n){if(e=!0,l<=n){this.Segment_At(_).Item_At(d).Highlight({first_unit_index:r-t.First_Unit_Index(),end_unit_index:l-t.First_Unit_Index()});break}this.Segment_At(_).Item_At(d).Highlight({first_unit_index:r-t.First_Unit_Index(),end_unit_index:t.Value().length})}}}}else if(e===d){let e=!1;for(let i=0,s=n.length;i<s;i+=1){const{segment_index:_,item_index:d}=n[i],l=t.Macro_Segment(_).Item(d);if(l.Is_Part())0,this.Segment_At(_).Item_At(d).Highlight({first_unit_index:r,end_unit_index:l.Value().length});else{const t=l,n=t.End_Unit_Index();e?this.Segment_At(_).Item_At(d).Highlight({first_unit_index:0,end_unit_index:t.Value().length}):r<n&&(e=!0,this.Segment_At(_).Item_At(d).Highlight({first_unit_index:r-t.First_Unit_Index(),end_unit_index:t.Value().length}))}}}else if(e===g)for(let e=0,i=n.length;e<i;e+=1){const{segment_index:s,item_index:_}=n[e],d=t.Macro_Segment(s).Item(_);if(d.Is_Part())0,this.Segment_At(s).Item_At(_).Highlight({first_unit_index:0,end_unit_index:l});else{const t=d;if(l<=t.End_Unit_Index()){this.Segment_At(s).Item_At(_).Highlight({first_unit_index:0,end_unit_index:l-t.First_Unit_Index()});break}this.Segment_At(s).Item_At(_).Highlight({first_unit_index:0,end_unit_index:t.Value().length})}}else for(let e=0,i=n.length;e<i;e+=1){const{segment_index:i,item_index:s}=n[e],_=t.Macro_Segment(i).Item(s);this.Segment_At(i).Item_At(s).Highlight({first_unit_index:0,end_unit_index:_.Value().length})}}}}}Blank_Segment(t){return new Segment.Instance({row:this,index:t,text:null})}Result(){return 0,this.Column().Result()}}