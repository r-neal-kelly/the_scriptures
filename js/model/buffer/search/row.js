import*as Utils from"../../../utils.js";import*as Entity from"../../entity.js";import*as Language from"../../language.js";import*as Text from"../../text.js";import*as Segment from"./segment.js";export class Instance extends Entity.Instance{static Min_Segment_Count(){return Instance.min_segment_count}static Set_Min_Segment_Count(t){0,Instance.min_segment_count=t}constructor({column:t,index:e}){if(super(),this.column=t,this.index=e,this.segments=[],null==t)0;else if(0,""===this.Value()){const t=new Text.Segment.Instance({segment_type:Text.Segment.Type.MICRO,index:0});t.Add_Item(new Text.Part.Instance({part_type:Text.Part.Type.POINT,index:0,value:"Â ",status:Text.Part.Status.GOOD,style:Text.Part.Style._NONE_,language:null})),this.segments.push(new Segment.Instance({row:this,index:0,text:t}))}else{const t=this.Text();for(let e=0,n=t.Macro_Segment_Count();e<n;e+=1)this.segments.push(new Segment.Instance({row:this,index:e,text:t.Macro_Segment(e)}));const e=this.Result(),n=this.Column().Index(),s=this.Index();for(let i=0,_=e.Match_Count(n,s);i<_;i+=1){const _=e.Match(n,s,i),r=_.First_Part_Index(),l=_.First_Part_First_Unit_Index(),u=_.Last_Part_End_Unit_Index(),a=_.Last_Part_Index();for(let e=r,n=_.End_Part_Index();e<n;e+=1){const n=t.Macro_Part_Segment_Item_Indices(e);if(e===r&&e===a){let e=!1;for(let s=0,i=n.length;s<i;s+=1){const{segment_index:_,item_index:r}=n[s],a=t.Macro_Segment(_).Item(r);if(a.Is_Part())0,this.Segment_At(_).Item_At(r).Highlight({first_unit_index:l,end_unit_index:u});else{const t=a,n=t.End_Unit_Index();if(e){if(u<=n){this.Segment_At(_).Item_At(r).Highlight({first_unit_index:0,end_unit_index:u-t.First_Unit_Index()});break}this.Segment_At(_).Item_At(r).Highlight({first_unit_index:0,end_unit_index:t.Value().length})}else if(l<n){if(e=!0,u<=n){this.Segment_At(_).Item_At(r).Highlight({first_unit_index:l-t.First_Unit_Index(),end_unit_index:u-t.First_Unit_Index()});break}this.Segment_At(_).Item_At(r).Highlight({first_unit_index:l-t.First_Unit_Index(),end_unit_index:t.Value().length})}}}}else if(e===r){let e=!1;for(let s=0,i=n.length;s<i;s+=1){const{segment_index:_,item_index:r}=n[s],u=t.Macro_Segment(_).Item(r);if(u.Is_Part())0,this.Segment_At(_).Item_At(r).Highlight({first_unit_index:l,end_unit_index:u.Value().length});else{const t=u,n=t.End_Unit_Index();e?this.Segment_At(_).Item_At(r).Highlight({first_unit_index:0,end_unit_index:t.Value().length}):l<n&&(e=!0,this.Segment_At(_).Item_At(r).Highlight({first_unit_index:l-t.First_Unit_Index(),end_unit_index:t.Value().length}))}}}else if(e===a)for(let e=0,s=n.length;e<s;e+=1){const{segment_index:i,item_index:_}=n[e],r=t.Macro_Segment(i).Item(_);if(r.Is_Part())0,this.Segment_At(i).Item_At(_).Highlight({first_unit_index:0,end_unit_index:u});else{const t=r;if(u<=t.End_Unit_Index()){this.Segment_At(i).Item_At(_).Highlight({first_unit_index:0,end_unit_index:u-t.First_Unit_Index()});break}this.Segment_At(i).Item_At(_).Highlight({first_unit_index:0,end_unit_index:t.Value().length})}}else for(let e=0,s=n.length;e<s;e+=1){const{segment_index:s,item_index:i}=n[e],_=t.Macro_Segment(s).Item(i);this.Segment_At(s).Item_At(i).Highlight({first_unit_index:0,end_unit_index:_.Value().length})}}}}this.Add_Dependencies(this.segments)}Has_Column(){return null!=this.column}Column(){return 0,this.column}Has_Index(){return null!=this.index}Index(){return 0,this.index}Has_Text(){return!this.Is_Blank()}Text(){return 0,this.Column().Text().Row(this.Index())}Has_Result(){return!this.Is_Blank()}Result(){return 0,this.Column().Result()}Has_Value(){return!this.Is_Blank()}Value(){return 0,this.Text().Value()}Segment_Count(){return this.segments.length}Segment_At(t){return 0,t<this.Segment_Count()?this.segments[t]:Instance.blank_segment}Is_Blank(){return!this.Has_Column()}Is_New_Line(){return""===this.Value()}Is_Centered(){return this.Text().Is_Centered()}Is_Padded(){return this.Text().Is_Padded()}Padding_Count(){return this.Text().Padding_Count()}Padding_Direction(){return this.Column().Line().Buffer().Default_Text_Direction()}Has_Styles(){return this.Has_Text()&&this.Padding_Count()>0}Styles(){if(this.Has_Styles()){const t=`${this.Column().Line().Buffer().Pad_EM(this.Padding_Count())}em`,e=this.Padding_Direction()===Language.Direction.LEFT_TO_RIGHT?"left":"right";return`\n                margin-${e}: ${t};\n                border-${e}-width: 1px;\n            `}return""}}Instance.min_segment_count=70,Instance.blank_segment=new Segment.Instance({row:null,index:null,text:null});