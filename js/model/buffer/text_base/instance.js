import*as Utils from"../../../utils.js";import*as Entity from"../../entity.js";import*as Languages from"../../languages.js";import{Default_Min_Counts}from"./default_min_counts.js";export class Instance extends Entity.Instance{constructor({default_language_name:e,default_font_name:t}){super(),this.default_language_name=e,this.default_font_name=t,this.lines=[],this.table_caches=[],this.working_table_cache=null}Default_Language_Name(){return this.default_language_name}Default_Language_Direction(){return Languages.Singleton().Direction(this.Default_Language_Name())}Default_Font_Name(){return this.default_font_name}Min_Line_Count(){return Default_Min_Counts.LINE}Line_Count(){return this.lines.length}Line_At(e){return 0,e<this.Line_Count()?this.lines[e]:this.Blank_Line()}Line_Column_Percents(e){for(let t=0,n=this.table_caches.length;t<n;t+=1){const n=this.table_caches[t];if(e>=n.first_line_index&&e<=n.last_line_index)return n.column_percents}return 0,[]}Push_Line(e){this.lines.push(e);const t=e.Text(),n=e.Index();if(t.Is_First_Row_Of_Table()){0,this.working_table_cache={first_line_index:n,max_column_lengths:[]};for(let e=0,n=t.Column_Count();e<n;e+=1){t.Column(e);this.working_table_cache.max_column_lengths.push(0)}}if(t.Is_Row_Of_Table()){0;const e=this.working_table_cache;for(let n=0,l=t.Column_Count();n<l;n+=1){const l=t.Column(n);for(let t=0,_=l.Row_Count();t<_;t+=1){const _=l.Row(t).Value();e.max_column_lengths[n]<_.length&&(e.max_column_lengths[n]=_.length)}}t.Text().Line_Count()-1===n&&this.Push_Working_Table_Cache(n)}else null!=this.working_table_cache&&this.Push_Working_Table_Cache(n)}Push_Working_Table_Cache(e){0;const t=this.working_table_cache,n={first_line_index:t.first_line_index,last_line_index:e,column_percents:[]};let l=0;for(let e=0,n=t.max_column_lengths.length;e<n;e+=1)l+=t.max_column_lengths[e];for(let e=0,_=t.max_column_lengths.length;e<_;e+=1)n.column_percents.push(100*t.max_column_lengths[e]/l);Object.freeze(n.column_percents),Object.freeze(n),this.table_caches.push(n),this.working_table_cache=null}}