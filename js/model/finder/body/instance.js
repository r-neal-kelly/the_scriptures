var __awaiter=this&&this.__awaiter||function(s,e,t,i){return new(t||(t=Promise))((function(n,r){function o(s){try{l(i.next(s))}catch(s){r(s)}}function a(s){try{l(i.throw(s))}catch(s){r(s)}}function l(s){var e;s.done?n(s.value):(e=s.value,e instanceof t?e:new t((function(s){s(e)}))).then(o,a)}l((i=i.apply(s,e||[])).next())}))};import*as Entity from"../../entity.js";import*as Data from"../../data.js";import*as Search from"../../search.js";import*as Selector from"../../selector.js";import*as Expression from"./expression.js";import*as Results from"./results.js";export class Instance extends Entity.Instance{constructor({finder:s}){super(),this.finder=s,this.filter=new Selector.Instance({does_smart_item_selection:!1}),this.expression=new Expression.Instance({body:this}),this.results=new Results.Instance({body:this,filter_slot_order:this.filter.Slot_Order(),versions_results:new Map,is_showing_commands:!1}),this.is_info_waiting=!1,this.Add_Dependencies([Data.Singleton(),Search.Singleton(),this.filter,this.expression,this.results])}Finder(){return this.finder}Filter(){return this.filter}Expression(){return this.expression}Results(){return this.results}Has_Empty_Results(){return this.Results().Tree().Root().Is_Empty()}Is_Info_Waiting(){return this.is_info_waiting}Set_Is_Info_Waiting(s){this.is_info_waiting=s}Search(){return __awaiter(this,void 0,void 0,(function*(){const s=this.Filter().File_Or_Versions(),e=this.Expression().Value();let t;if(s instanceof Data.File.Instance){const i=s,n=yield Search.Singleton().Data_File(i,e);if(n instanceof Search.Parser.Help)t=n;else if(t=new Map,n.length>0){const s=new Map;s.set(i,n),t.set(i.Version(),s)}}else t=yield Search.Singleton().Data_Versions(s,e);if(t instanceof Search.Parser.Help)this.expression.Set_Help(t),this.results=new Results.Instance({body:this,filter_slot_order:this.filter.Slot_Order(),versions_results:new Map,is_showing_commands:!1});else{const s=e.includes(Search.Operator.META);this.expression.Set_Help(null),this.results=new Results.Instance({body:this,filter_slot_order:this.filter.Slot_Order(),versions_results:t,is_showing_commands:s})}}))}}