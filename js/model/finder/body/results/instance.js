var __awaiter=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(o,i){function r(t){try{_(s.next(t))}catch(t){i(t)}}function a(t){try{_(s.throw(t))}catch(t){i(t)}}function _(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}_((s=s.apply(t,e||[])).next())}))};import*as Utils from"../../../../utils.js";import*as Async from"../../../../async.js";import*as Language from"../../../language.js";import*as Text from"../../../text.js";import*as Filter from"../../../selector.js";import*as Tree from"./tree.js";import*as Buffer from"../../../buffer/search.js";export class Instance extends Async.Instance{constructor({body:t,filter_slot_order:e,versions_results:n,is_showing_commands:s}){super();const o=new Set,i=new Set,r=new Set;this.file_count=0,this.line_count=0,this.match_count=0;const a={},_=function(t,e,n,s){null==a[t]&&(a[t]={}),null==a[t][e]&&(a[t][e]={}),0,a[t][e][n]=[];for(const o of s){this.file_count+=1,this.line_count+=o[1].length;for(const t of o[1])this.match_count+=t.Total_Match_Count();a[t][e][n].push({file:o[0],results:o[1]})}}.bind(this);if(e===Filter.Slot.Order.BOOKS_LANGUAGES_VERSIONS)for(const t of n){const e=t[0].Language().Book().Name(),n=t[0].Language().Name(),s=t[0].Name();o.add(e),i.add(n),r.add(s),_(e,n,s,t[1])}else if(e===Filter.Slot.Order.BOOKS_VERSIONS_LANGUAGES)for(const t of n){const e=t[0].Language().Book().Name(),n=t[0].Language().Name(),s=t[0].Name();o.add(e),i.add(n),r.add(s),_(e,s,n,t[1])}else if(e===Filter.Slot.Order.LANGUAGES_BOOKS_VERSIONS)for(const t of n){const e=t[0].Language().Book().Name(),n=t[0].Language().Name(),s=t[0].Name();o.add(e),i.add(n),r.add(s),_(n,e,s,t[1])}else if(e===Filter.Slot.Order.LANGUAGES_VERSIONS_BOOKS)for(const t of n){const e=t[0].Language().Book().Name(),n=t[0].Language().Name(),s=t[0].Name();o.add(e),i.add(n),r.add(s),_(n,s,e,t[1])}else if(e===Filter.Slot.Order.VERSIONS_BOOKS_LANGUAGES)for(const t of n){const e=t[0].Language().Book().Name(),n=t[0].Language().Name(),s=t[0].Name();o.add(e),i.add(n),r.add(s),_(s,e,n,t[1])}else if(e===Filter.Slot.Order.VERSIONS_LANGUAGES_BOOKS)for(const t of n){const e=t[0].Language().Book().Name(),n=t[0].Language().Name(),s=t[0].Name();o.add(e),i.add(n),r.add(s),_(s,n,e,t[1])}else 0;this.book_count=o.size,this.language_count=i.size,this.version_count=r.size;{const t=1===this.match_count?"1 match":`${this.match_count} matches`,n=1===this.line_count?"1 line":`${this.line_count} lines`,s=1===this.file_count?"1 file":`${this.file_count} files`,o=1===this.version_count?"1 version":`${this.version_count} versions`,i=1===this.language_count?"1 language":`${this.language_count} languages`,r=1===this.book_count?"1 book":`${this.book_count} books`;e===Filter.Slot.Order.BOOKS_LANGUAGES_VERSIONS?this.counts_as_string=`${t} in ${n}, ${s}, ${o}, ${i}, and ${r}`:e===Filter.Slot.Order.BOOKS_VERSIONS_LANGUAGES?this.counts_as_string=`${t} in ${n}, ${s}, ${i}, ${o}, and ${r}`:e===Filter.Slot.Order.LANGUAGES_BOOKS_VERSIONS?this.counts_as_string=`${t} in ${n}, ${s}, ${o}, ${r}, and ${i}`:e===Filter.Slot.Order.LANGUAGES_VERSIONS_BOOKS?this.counts_as_string=`${t} in ${n}, ${s}, ${r}, ${o}, and ${i}`:e===Filter.Slot.Order.VERSIONS_BOOKS_LANGUAGES?this.counts_as_string=`${t} in ${n}, ${s}, ${i}, ${r}, and ${o}`:e===Filter.Slot.Order.VERSIONS_LANGUAGES_BOOKS?this.counts_as_string=`${t} in ${n}, ${s}, ${r}, ${i}, and ${o}`:(0,this.counts_as_string="")}this.body=t,this.tree=new Tree.Instance({results:this,data:a}),this.is_showing_commands=s,this.buffer=new Buffer.Instance({default_language_name:Language.Name.ENGLISH,underlying_font_size_px:this.Body().Options().Underlying_Font_Size_PX(),text:new Text.Instance,results:[],is_showing_commands:s}),this.Add_Dependencies([this.buffer])}Body(){return this.body}Tree(){return this.tree}Buffer(){return this.buffer}Set_Buffer(t,e,n){return __awaiter(this,void 0,void 0,(function*(){this.buffer=new Buffer.Instance({default_language_name:t,underlying_font_size_px:this.Body().Options().Underlying_Font_Size_PX(),text:e,results:n,is_showing_commands:this.is_showing_commands}),yield this.buffer.Ready()}))}Book_Count(){return this.book_count}Language_Count(){return this.language_count}Version_Count(){return this.version_count}File_Count(){return this.file_count}Line_Count(){return this.line_count}Match_Count(){return this.match_count}Counts_As_String(){return this.counts_as_string}}