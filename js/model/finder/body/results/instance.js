import*as Utils from"../../../../utils.js";import*as Language from"../../../language.js";import*as Entity from"../../../entity.js";import*as Filter from"../../../selector.js";import*as Tree from"./tree.js";import*as Buffer from"../../../buffer/search.js";export class Instance extends Entity.Instance{constructor({body:t,filter_slot_order:e,versions_results:s,is_showing_commands:n}){super();const o=new Set,i=new Set,r=new Set;this.file_count=0,this.line_count=0,this.match_count=0;const a={},u=function(t,e,s,n){null==a[t]&&(a[t]={}),null==a[t][e]&&(a[t][e]={}),Utils.Assert(null==a[t][e][s],"Can't clobber files!"),a[t][e][s]=[];for(const o of n){this.file_count+=1,this.line_count+=o[1].length;for(const t of o[1])this.match_count+=t.Match_Count();a[t][e][s].push({file:o[0],results:o[1]})}}.bind(this);if(e===Filter.Slot.Order.BOOKS_LANGUAGES_VERSIONS)for(const t of s){const e=t[0].Language().Book().Name(),s=t[0].Language().Name(),n=t[0].Name();o.add(e),i.add(s),r.add(n),u(e,s,n,t[1])}else if(e===Filter.Slot.Order.BOOKS_VERSIONS_LANGUAGES)for(const t of s){const e=t[0].Language().Book().Name(),s=t[0].Language().Name(),n=t[0].Name();o.add(e),i.add(s),r.add(n),u(e,n,s,t[1])}else if(e===Filter.Slot.Order.LANGUAGES_BOOKS_VERSIONS)for(const t of s){const e=t[0].Language().Book().Name(),s=t[0].Language().Name(),n=t[0].Name();o.add(e),i.add(s),r.add(n),u(s,e,n,t[1])}else if(e===Filter.Slot.Order.LANGUAGES_VERSIONS_BOOKS)for(const t of s){const e=t[0].Language().Book().Name(),s=t[0].Language().Name(),n=t[0].Name();o.add(e),i.add(s),r.add(n),u(s,n,e,t[1])}else if(e===Filter.Slot.Order.VERSIONS_BOOKS_LANGUAGES)for(const t of s){const e=t[0].Language().Book().Name(),s=t[0].Language().Name(),n=t[0].Name();o.add(e),i.add(s),r.add(n),u(n,e,s,t[1])}else if(e===Filter.Slot.Order.VERSIONS_LANGUAGES_BOOKS)for(const t of s){const e=t[0].Language().Book().Name(),s=t[0].Language().Name(),n=t[0].Name();o.add(e),i.add(s),r.add(n),u(n,s,e,t[1])}else Utils.Assert(!1,"Unknown filter_slot_order.");this.book_count=o.size,this.language_count=i.size,this.version_count=r.size;{const t=1===this.match_count?"1 match":`${this.match_count} matches`,s=1===this.line_count?"1 line":`${this.line_count} lines`,n=1===this.file_count?"1 file":`${this.file_count} files`,o=1===this.version_count?"1 version":`${this.version_count} versions`,i=1===this.language_count?"1 language":`${this.language_count} languages`,r=1===this.book_count?"1 book":`${this.book_count} books`;e===Filter.Slot.Order.BOOKS_LANGUAGES_VERSIONS?this.counts_as_string=`${t} in ${s}, ${n}, ${o}, ${i}, and ${r}`:e===Filter.Slot.Order.BOOKS_VERSIONS_LANGUAGES?this.counts_as_string=`${t} in ${s}, ${n}, ${i}, ${o}, and ${r}`:e===Filter.Slot.Order.LANGUAGES_BOOKS_VERSIONS?this.counts_as_string=`${t} in ${s}, ${n}, ${o}, ${r}, and ${i}`:e===Filter.Slot.Order.LANGUAGES_VERSIONS_BOOKS?this.counts_as_string=`${t} in ${s}, ${n}, ${r}, ${o}, and ${i}`:e===Filter.Slot.Order.VERSIONS_BOOKS_LANGUAGES?this.counts_as_string=`${t} in ${s}, ${n}, ${i}, ${r}, and ${o}`:e===Filter.Slot.Order.VERSIONS_LANGUAGES_BOOKS?this.counts_as_string=`${t} in ${s}, ${n}, ${r}, ${i}, and ${o}`:(Utils.Assert(!1,"Unknown filter_slot_order."),this.counts_as_string="")}this.body=t,this.tree=new Tree.Instance({results:this,data:a}),this.is_showing_commands=n,this.buffer=new Buffer.Instance({default_language_name:Language.Name.ENGLISH,results:[],is_showing_commands:n}),this.Add_Dependencies([this.tree,this.buffer])}Body(){return this.body}Tree(){return this.tree}Buffer(){return this.buffer}Set_Buffer(t,e){this.buffer=new Buffer.Instance({default_language_name:t,results:e,is_showing_commands:this.is_showing_commands})}Book_Count(){return this.book_count}Language_Count(){return this.language_count}Version_Count(){return this.version_count}File_Count(){return this.file_count}Line_Count(){return this.line_count}Match_Count(){return this.match_count}Counts_As_String(){return this.counts_as_string}}