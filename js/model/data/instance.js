var __awaiter=this&&this.__awaiter||function(e,s,a,n){return new(a||(a=Promise))((function(o,t){function r(e){try{y(n.next(e))}catch(e){t(e)}}function i(e){try{y(n.throw(e))}catch(e){t(e)}}function y(e){var s;e.done?o(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(r,i)}y((n=n.apply(e,s||[])).next())}))};import*as Utils from"../../utils.js";import*as Async from"../../async.js";import*as Compressor from"../../compressor.js";import*as Name_Sorter from"../name_sorter.js";import{Type}from"./type.js";import{Info}from"./info.js";import*as Book from"./book.js";export var Consts;!function(e){e.INFO_FILE_NAME="Info.comp"}(Consts||(Consts={}));export class Instance extends Async.Instance{constructor(){super(),this.name="data",this.path=this.name,this.books_path=`${this.path}/Books`,this.info=null,this.books=[],this.Add_Dependencies([])}Name(){return this.name}Path(){return this.path}Books_Path(){return this.books_path}Info(){return 0,0,this.info}Book(e){0;for(const s of this.books)if(s.Name()===e)return s;return 0,this.books[0]}Book_Count(){return 0,this.books.length}Book_At(e){return 0,0,0,this.books[e]}Books(){return 0,Array.from(this.books)}Names({of:e,language_names_must_have_files:s}){return 0,1===e.length?(0,e[0].Type()===Type.BOOKS||e[0].Type()===Type.BOOK?this.Book_Names():e[0].Type()===Type.LANGUAGES||e[0].Type()===Type.LANGUAGE?s?this.Language_Names_Having_Files():this.Language_Names():e[0].Type()===Type.VERSIONS||e[0].Type()===Type.VERSION?this.Version_Names():(0,[])):2===e.length?(0,0,e[0].Type()!==Type.BOOKS&&e[0].Type()!==Type.BOOK||e[1].Type()!==Type.LANGUAGES&&e[1].Type()!==Type.LANGUAGE?e[0].Type()!==Type.BOOKS&&e[0].Type()!==Type.BOOK||e[1].Type()!==Type.VERSIONS&&e[1].Type()!==Type.VERSION?e[0].Type()!==Type.LANGUAGES&&e[0].Type()!==Type.LANGUAGE||e[1].Type()!==Type.BOOKS&&e[1].Type()!==Type.BOOK?e[0].Type()!==Type.LANGUAGES&&e[0].Type()!==Type.LANGUAGE||e[1].Type()!==Type.VERSIONS&&e[1].Type()!==Type.VERSION?e[0].Type()!==Type.VERSIONS&&e[0].Type()!==Type.VERSION||e[1].Type()!==Type.BOOKS&&e[1].Type()!==Type.BOOK?e[0].Type()!==Type.VERSIONS&&e[0].Type()!==Type.VERSION||e[1].Type()!==Type.LANGUAGES&&e[1].Type()!==Type.LANGUAGE?(0,[]):this.Version_Language_Names({version_name:e[0].Name()}):this.Version_Book_Names({version_name:e[0].Name()}):this.Language_Version_Names({language_name:e[0].Name()}):this.Language_Book_Names({language_name:e[0].Name()}):this.Book_Version_Names({book_name:e[0].Name()}):this.Book_Language_Names({book_name:e[0].Name()})):3===e.length?(0,0,e[0].Type()!==Type.BOOKS&&e[0].Type()!==Type.BOOK||e[1].Type()!==Type.LANGUAGES&&e[1].Type()!==Type.LANGUAGE||e[2].Type()!==Type.VERSIONS&&e[2].Type()!==Type.VERSION?e[0].Type()!==Type.BOOKS&&e[0].Type()!==Type.BOOK||e[1].Type()!==Type.VERSIONS&&e[1].Type()!==Type.VERSION||e[2].Type()!==Type.LANGUAGES&&e[2].Type()!==Type.LANGUAGE?e[0].Type()!==Type.LANGUAGES&&e[0].Type()!==Type.LANGUAGE||e[1].Type()!==Type.BOOKS&&e[1].Type()!==Type.BOOK||e[2].Type()!==Type.VERSIONS&&e[2].Type()!==Type.VERSION?e[0].Type()!==Type.LANGUAGES&&e[0].Type()!==Type.LANGUAGE||e[1].Type()!==Type.VERSIONS&&e[1].Type()!==Type.VERSION||e[2].Type()!==Type.BOOKS&&e[2].Type()!==Type.BOOK?e[0].Type()!==Type.VERSIONS&&e[0].Type()!==Type.VERSION||e[1].Type()!==Type.BOOKS&&e[1].Type()!==Type.BOOK||e[2].Type()!==Type.LANGUAGES&&e[2].Type()!==Type.LANGUAGE?e[0].Type()!==Type.VERSIONS&&e[0].Type()!==Type.VERSION||e[1].Type()!==Type.LANGUAGES&&e[1].Type()!==Type.LANGUAGE||e[2].Type()!==Type.BOOKS&&e[2].Type()!==Type.BOOK?(0,[]):this.Version_Language_Book_Names({version_name:e[0].Name(),language_name:e[1].Name()}):this.Version_Book_Language_Names({version_name:e[0].Name(),book_name:e[1].Name()}):this.Language_Version_Book_Names({language_name:e[0].Name(),version_name:e[1].Name()}):this.Language_Book_Version_Names({language_name:e[0].Name(),book_name:e[1].Name()}):this.Book_Version_Language_Names({book_name:e[0].Name(),version_name:e[1].Name()}):this.Book_Language_Version_Names({book_name:e[0].Name(),language_name:e[1].Name()})):4===e.length?(0,0,0,e[0].Type()!==Type.BOOKS&&e[0].Type()!==Type.BOOK||e[1].Type()!==Type.LANGUAGES&&e[1].Type()!==Type.LANGUAGE||e[2].Type()!==Type.VERSIONS&&e[2].Type()!==Type.VERSION?e[0].Type()!==Type.BOOKS&&e[0].Type()!==Type.BOOK||e[1].Type()!==Type.VERSIONS&&e[1].Type()!==Type.VERSION||e[2].Type()!==Type.LANGUAGES&&e[2].Type()!==Type.LANGUAGE?e[0].Type()!==Type.LANGUAGES&&e[0].Type()!==Type.LANGUAGE||e[1].Type()!==Type.BOOKS&&e[1].Type()!==Type.BOOK||e[2].Type()!==Type.VERSIONS&&e[2].Type()!==Type.VERSION?e[0].Type()!==Type.LANGUAGES&&e[0].Type()!==Type.LANGUAGE||e[1].Type()!==Type.VERSIONS&&e[1].Type()!==Type.VERSION||e[2].Type()!==Type.BOOKS&&e[2].Type()!==Type.BOOK?e[0].Type()!==Type.VERSIONS&&e[0].Type()!==Type.VERSION||e[1].Type()!==Type.BOOKS&&e[1].Type()!==Type.BOOK||e[2].Type()!==Type.LANGUAGES&&e[2].Type()!==Type.LANGUAGE?e[0].Type()!==Type.VERSIONS&&e[0].Type()!==Type.VERSION||e[1].Type()!==Type.LANGUAGES&&e[1].Type()!==Type.LANGUAGE||e[2].Type()!==Type.BOOKS&&e[2].Type()!==Type.BOOK?(0,[]):this.File_Names({book_name:e[2].Name(),language_name:e[1].Name(),version_name:e[0].Name()}):this.File_Names({book_name:e[1].Name(),language_name:e[2].Name(),version_name:e[0].Name()}):this.File_Names({book_name:e[2].Name(),language_name:e[0].Name(),version_name:e[1].Name()}):this.File_Names({book_name:e[1].Name(),language_name:e[0].Name(),version_name:e[2].Name()}):this.File_Names({book_name:e[0].Name(),language_name:e[2].Name(),version_name:e[1].Name()}):this.File_Names({book_name:e[0].Name(),language_name:e[1].Name(),version_name:e[2].Name()})):(0,[])}Book_Names(){return 0,this.Info().Unique_Book_Names()}Book_Language_Names({book_name:e}){0;const s=new Set;for(const a of this.Books())if(a.Name()===e){for(const e of a.Languages())s.add(e.Name());break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.LANGUAGES,s)}Book_Version_Names({book_name:e}){0;const s=new Set;for(const a of this.Books())if(a.Name()===e){for(const e of a.Languages())for(const a of e.Versions())s.add(a.Name());break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.VERSIONS,s)}Book_Language_Version_Names({book_name:e,language_name:s}){0;const a=new Set;for(const n of this.Books())if(n.Name()===e){for(const e of n.Languages())if(e.Name()===s){for(const s of e.Versions())a.add(s.Name());break}break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.VERSIONS,a)}Book_Version_Language_Names({book_name:e,version_name:s}){0;const a=new Set;for(const n of this.Books())if(n.Name()===e){for(const e of n.Languages())for(const n of e.Versions())if(n.Name()===s){a.add(e.Name());break}break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.LANGUAGES,a)}Language_Names(){return 0,this.Info().Unique_Language_Names()}Language_Names_Having_Files(){return 0,this.Info().Unique_Language_Names_Having_Files()}Language_Book_Names({language_name:e}){0;const s=new Set;for(const a of this.Books())for(const n of a.Languages())if(n.Name()===e){s.add(a.Name());break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.BOOKS,s)}Language_Version_Names({language_name:e}){0;const s=new Set;for(const a of this.Books())for(const n of a.Languages())if(n.Name()===e){for(const e of n.Versions())s.add(e.Name());break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.VERSIONS,s)}Language_Book_Version_Names({language_name:e,book_name:s}){0;const a=new Set;for(const n of this.Books())if(n.Name()===s){for(const s of n.Languages())if(s.Name()===e){for(const e of s.Versions())a.add(e.Name());break}break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.VERSIONS,a)}Language_Version_Book_Names({language_name:e,version_name:s}){0;const a=new Set;for(const n of this.Books())for(const o of n.Languages())if(o.Name()===e){for(const e of o.Versions())if(e.Name()===s){a.add(n.Name());break}break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.BOOKS,a)}Version_Names(){return 0,this.Info().Unique_Version_Names()}Version_Book_Names({version_name:e}){0;const s=new Set;for(const a of this.Books())for(const n of a.Languages())for(const o of n.Versions())if(o.Name()===e){s.add(a.Name());break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.BOOKS,s)}Version_Language_Names({version_name:e}){0;const s=new Set;for(const a of this.Books())for(const n of a.Languages())for(const a of n.Versions())if(a.Name()===e){s.add(n.Name());break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.LANGUAGES,s)}Version_Book_Language_Names({version_name:e,book_name:s}){0;const a=new Set;for(const n of this.Books())if(n.Name()===s){for(const s of n.Languages())for(const n of s.Versions())if(n.Name()===e){a.add(s.Name());break}break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.LANGUAGES,a)}Version_Language_Book_Names({version_name:e,language_name:s}){0;const a=new Set;for(const n of this.Books())for(const o of n.Languages())if(o.Name()===s){for(const s of o.Versions())if(s.Name()===e){a.add(n.Name());break}break}return Name_Sorter.Singleton().With_Set(Name_Sorter.Type.BOOKS,a)}Versions({book_names:e=null,language_names:s=null,version_names:a=null}){0;const n=[];null==e&&(e=this.Book_Names()),null==s&&(s=this.Language_Names()),null==a&&(a=this.Version_Names());for(const o of this.Books())if(e.includes(o.Name()))for(const e of o.Languages())if(s.includes(e.Name()))for(const s of e.Versions())a.includes(s.Name())&&n.push(s);return n}Files({book_name:e,language_name:s,version_name:a}){return 0,this.Book(e).Language(s).Version(a).Files()}File({book_name:e,language_name:s,version_name:a,file_name:n}){return 0,this.Book(e).Language(s).Version(a).File(n)}File_Names({book_name:e,language_name:s,version_name:a}){return 0,this.Files({book_name:e,language_name:s,version_name:a}).map((function(e){return e.Name()}))}After_Dependencies_Are_Ready(){return __awaiter(this,void 0,void 0,(function*(){const e=yield fetch(Utils.Resolve_Path(`${this.Path()}/${Consts.INFO_FILE_NAME}`));if(e.ok){this.info=new Info({json:Compressor.LZSS_Decompress(yield e.text())});for(const e of this.info.Tree().books)this.books.push(new Book.Instance({data:this,branch:e}))}else this.info=new Info({}),this.info.Finalize()}))}}const SINGLETON=new Instance;export function Singleton(){return SINGLETON}