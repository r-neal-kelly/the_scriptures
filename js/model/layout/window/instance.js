var __awaiter=this&&this.__awaiter||function(t,i,s,e){return new(s||(s=Promise))((function(a,l){function n(t){try{r(e.next(t))}catch(t){l(t)}}function o(t){try{r(e.throw(t))}catch(t){l(t)}}function r(t){var i;t.done?a(t.value):(i=t.value,i instanceof s?i:new s((function(t){t(i)}))).then(n,o)}r((e=e.apply(t,i||[])).next())}))};import*as Utils from"../../../utils.js";import*as Entity from"../../entity.js";import{State}from"./state.js";import*as Bar from"./bar.js";export class Instance extends Entity.Instance{constructor({wall:t,program:i}){super(),this.wall=t,this.state=State._NONE_,this.program=i,this.bar=new Bar.Instance({window:this}),this.Add_Dependencies([this.program,this.bar])}Is_In_Wall(){return Utils.Assert(this.Is_Alive(),"Cannot know if a dead window is in a wall."),null!=this.wall}Wall(){return Utils.Assert(this.Is_Alive(),"Window must be alive to get its wall."),Utils.Assert(this.Is_In_Wall(),"Isn't in a wall."),this.wall}Add_To_Wall(t){Utils.Assert(this.Is_Alive(),"Window must be alive to be added to a wall."),Utils.Assert(!this.Is_In_Wall(),"Is already in a wall."),t.Add(this),this.wall=t}Remove_From_Wall(){Utils.Assert(this.Is_Alive(),"Window must be alive to be removed from a wall."),Utils.Assert(this.Is_In_Wall(),"Isn't in a wall."),this.Wall().Remove(this.ID()),this.wall=null}Move_To_Wall(t){Utils.Assert(this.Is_Alive(),"Window must be alive to be moved to a wall."),this.Is_In_Wall()&&this.Remove_From_Wall(),null!=t&&this.Add_To_Wall(t)}State(){return this.state}Program(){return Utils.Assert(this.Is_Alive(),"Window must be alive to get its model."),Utils.Assert(this.Is_Ready(),"Window does not have a ready program, it's probably still loading in."),this.program}Bar(){return this.bar}Is_Alive(){return 0!=(this.state&State.IS_ALIVE)}Live(){if(Utils.Assert(!this.Is_Alive(),"Window is already alive."),this.state|=State.IS_ALIVE,null!=this.wall){const t=this.wall;this.wall=null,this.Add_To_Wall(t)}}Kill(){Utils.Assert(this.Is_Alive(),"Window is already dead."),this.Move_To_Wall(null),this.state&=~State.IS_ALIVE}Is_Minimized(){return Utils.Assert(this.Is_Alive(),"Cannot know if a dead window is minimized."),0!=(this.state&State.IS_MINIMIZED)}Minimize(){Utils.Assert(this.Is_Alive(),"Cannot minimize a dead window."),this.state|=State.IS_MINIMIZED}Unminimize(){Utils.Assert(this.Is_Alive(),"Cannot unminimize a dead window."),this.state&=~State.IS_MINIMIZED}Toggle_Minimization(){Utils.Assert(this.Is_Alive(),"Cannot toggle minimization of a dead window."),this.state^=State.IS_MINIMIZED}Is_Maximized(){return Utils.Assert(this.Is_Alive(),"Cannot know if a dead window is maximized."),0!=(this.state&State.IS_MAXIMIZED)}Maximize(){Utils.Assert(this.Is_Alive(),"Cannot maximize a dead window."),this.state|=State.IS_MAXIMIZED}Unmaximize(){Utils.Assert(this.Is_Alive(),"Cannot unmaximize a dead window."),this.state&=~State.IS_MAXIMIZED}Toggle_Maximization(){Utils.Assert(this.Is_Alive(),"Cannot toggle maximization of a dead window."),this.state^=State.IS_MAXIMIZED}Is_Active(){return this.Wall().Layout().Maybe_Active_Window()===this}Before_Dependencies_Are_Ready(){return __awaiter(this,void 0,void 0,(function*(){this.Live()}))}}