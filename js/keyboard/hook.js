var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,r){function o(t){try{_(i.next(t))}catch(t){r(t)}}function s(t){try{_(i.throw(t))}catch(t){r(t)}}function _(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}_((i=i.apply(t,e||[])).next())}))};import*as Language from"../model/language.js";import*as Languages from"../model/languages.js";import{Script_Position}from"../model/script_position.js";export class Instance{constructor({keyboard:t,div:e}){this.keyboard=t,this.div=e}Keyboard(){return this.keyboard}Div(){return this.div}Enable(){this.keyboard.Has_Div(this.div)||(this.div.setAttribute("contentEditable","true"),this.keyboard.Add_Div(this.div,this))}Disable(){this.keyboard.Has_Div(this.div)&&(this.keyboard.Remove_Div(this.div),this.div.setAttribute("contentEditable","false"))}On_Change_Underlying_Font_Size_PX(){return __awaiter(this,void 0,void 0,(function*(){yield this.Update_Language_Styles(this.keyboard.Current_Language_Name())}))}On_Change_Global_Layout(t){return __awaiter(this,void 0,void 0,(function*(){yield this.Update_Language_Styles(null!=t?t.Language_Name():Language.Name.ENGLISH)}))}On_Try_Change_Language_Direction(t){return __awaiter(this,void 0,void 0,(function*(){return!0}))}Update_Language_Styles(t){return __awaiter(this,void 0,void 0,(function*(){const e=Languages.Singleton().Direction(t),n=Languages.Singleton().Default_Global_Font_Styles({language_name:t,underlying_font_size_px:this.Underlying_Font_Size_PX(),underlying_font_size_multiplier:1,script_position:Script_Position.DEFAULT});for(const t of Object.entries(n))this.div.style[t[0]]=t[1];e===Language.Direction.LEFT_TO_RIGHT?"ltr"!==this.div.style.direction&&(yield this.On_Try_Change_Language_Direction(e))&&(this.div.style.direction="ltr"):"rtl"!==this.div.style.direction&&(yield this.On_Try_Change_Language_Direction(e))&&(this.div.style.direction="rtl")}))}On_Key_Down(t){return __awaiter(this,void 0,void 0,(function*(){}))}On_Key_Up(t){return __awaiter(this,void 0,void 0,(function*(){}))}On_Insert({data:t,range:e}){return __awaiter(this,void 0,void 0,(function*(){const n=document.createTextNode(t);e.deleteContents(),e.insertNode(n);const i=document.getSelection();i&&i.collapse(n,n.nodeValue.length),null!=n.parentElement&&n.parentElement.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"})}))}On_Paste({data:t,range:e}){return __awaiter(this,void 0,void 0,(function*(){yield this.On_Insert({data:t,range:e})}))}On_Delete({range:t}){return __awaiter(this,void 0,void 0,(function*(){t.deleteContents();const e=t.startContainer;null!=e.parentElement&&e.parentElement.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"})}))}After_Insert_Or_Paste_Or_Delete(){return __awaiter(this,void 0,void 0,(function*(){}))}}