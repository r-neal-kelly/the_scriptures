var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function _(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,_)}a((i=i.apply(e,t||[])).next())}))};import*as Utils from"../../../utils.js";import*as Event from"../../../event.js";import*as Events from"../../events.js";import*as Entity from"../../entity.js";export class Instance extends Entity.Instance{constructor({body:e,model:t}){super({element:"div",parent:e,event_grid:e.Event_Grid()}),this.model=t,this.Live()}On_Life(){return[new Event.Listener_Info({event_name:new Event.Name(Event.Prefix.ON,Events.FINDER_BODY_BEFORE_SEARCH,this.Body().Finder().ID()),event_handler:this.On_Finder_Body_Before_Search,event_priority:0}),new Event.Listener_Info({event_name:new Event.Name(Event.Prefix.ON,Events.FINDER_BODY_AFTER_SEARCH,this.Body().Finder().ID()),event_handler:this.On_Finder_Body_After_Search,event_priority:0})]}On_Refresh(){this.Model().Has_Empty_Results()&&""===this.Model().Expression().Value()?this.Element().textContent=null:this.Element().textContent=this.Model().Results().Counts_As_String()}On_Reclass(){this.Model();const e=[];return e.push("Info"),this.Model().Has_Empty_Results()&&""===this.Model().Expression().Value()&&e.push("Invisible"),e}On_Finder_Body_Before_Search(){return __awaiter(this,void 0,void 0,(function*(){(function(){return __awaiter(this,void 0,void 0,(function*(){for(;this.Is_Alive()&&this.Model().Is_Info_Waiting();){const e=this.Element();"Searching."===e.textContent?e.textContent="Searching..":"Searching.."===e.textContent?e.textContent="Searching...":e.textContent="Searching.",yield Utils.Wait_Milliseconds(200)}}))}).bind(this)()}))}On_Finder_Body_After_Search(){return __awaiter(this,void 0,void 0,(function*(){this.Refresh()}))}Model(){return this.model()}Body(){return this.Parent()}}