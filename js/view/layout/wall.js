var __awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{d(n.next(t))}catch(t){r(t)}}function l(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,l)}d((n=n.apply(t,e||[])).next())}))};import*as Utils from"../../utils.js";import*as Event from"../../event.js";import*as Model from"../../model/layout/wall.js";import*as Events from"../events.js";import*as Entity from"../entity.js";import*as Window from"./window.js";export class Instance extends Entity.Instance{constructor({model:t,layout:e}){super({element:"div",parent:e,event_grid:e.Event_Grid()}),this.model=t,this.kill_index=null,this.Live()}On_Life(){return[new Event.Listener_Info({event_name:new Event.Name(Event.Prefix.AFTER,Events.WINDOW_TOGGLE_MAXIMIZATION,this.ID()),event_handler:this.After_Window_Toggle_Maximization,event_priority:0}),new Event.Listener_Info({event_name:new Event.Name(Event.Prefix.AFTER,Events.WINDOW_CLOSE,this.Layout().ID()),event_handler:this.After_Window_Close,event_priority:0})]}On_Refresh(){if(null==this.kill_index){const t=this.Model().Window_Count(),e=this.Child_Count(),i=t-e;if(i<0)for(let t=e,n=e+i;t>n;)t-=1,this.Abort_Child(this.Child(t));else if(i>0)for(let t=e,n=e+i;t<n;t+=1)new Window.Instance({model:()=>this.Model().Window_At(t),wall:this})}else{this.Abort_Child(this.Child(this.kill_index)),this.Skip_Children();for(let t=0,e=this.Child_Count();t<e;t+=1){this.Child(t).__Set_Model__((()=>this.Model().Window_At(t)))}}}On_Reclass(){return["Wall"]}On_Restyle(){const t=this.Model(),e=t.Render_Type(),i=t.Render_Limit(),n=t.Window_Count(),o=t.Maximized_Window_Count(),r="grid-template-columns",s="grid-template-rows",l=e===Model.Render_Type.LANDSCAPE?r:s,d=l===r?s:r,_=e===Model.Render_Type.LANDSCAPE?"grid-column-gap":"grid-row-gap";return`\n            ${l}: repeat(${i}, calc(${100/i}% - ${Math.round(2*(i-1)/i)}px));\n            ${d}: repeat(${Math.ceil(n/i)+o}, 100%);\n            ${_}: 2px;\n        `}After_Window_Toggle_Maximization(){return __awaiter(this,void 0,void 0,(function*(){this.Reclass()}))}After_Window_Close({window_index:t}){return __awaiter(this,void 0,void 0,(function*(){this.kill_index=t,this.Refresh(),this.kill_index=null}))}Model(){return this.model()}Layout(){return this.Parent()}Window_With_Model(t){for(let e=0,i=this.Child_Count();e<i;e+=1){const i=this.Child(e);if(i.Model()===t)return i}return 0,this.Child(0)}}