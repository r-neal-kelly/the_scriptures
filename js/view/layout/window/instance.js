var __awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function r(t){try{l(s.next(t))}catch(t){a(t)}}function o(t){try{l(s.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}l((s=s.apply(t,e||[])).next())}))};import*as Utils from"../../../utils.js";import*as Entity from"../../entity.js";import*as Bar from"./bar.js";export class Instance extends Entity.Instance{constructor({model:t,wall:e}){super({element:"div",parent:e,event_grid:e.Event_Grid()}),this.model=t,this.Live()}On_Life(){return this.Element().addEventListener("click",this.On_Click.bind(this)),this.Refresh_After_Has_Model(),[]}On_Refresh(){this.Model().Is_Ready()&&(this.Has_Bar()&&this.Has_View()||(this.Abort_All_Children(),this.Element().textContent="",new Bar.Instance({model:()=>this.Model().Bar(),window:this}),new(this.Model().Program().View_Class())({model:()=>this.Model().Program().Model_Instance(),root:this})))}On_Reclass(){return["Window"]}On_Click(){return __awaiter(this,void 0,void 0,(function*(){this.Model().Wall().Layout().Set_Active_Window(this.Model()),this.Wall().Layout().Refresh()}))}Refresh_After_Has_Model(){return __awaiter(this,void 0,void 0,(function*(){for(yield Utils.Wait_Milliseconds(1);this.Is_Alive()&&!this.Model().Is_Ready();){const t=this.Element();"Loading."===t.textContent?t.textContent="Loading..":"Loading.."===t.textContent?t.textContent="Loading...":t.textContent="Loading.",yield Utils.Wait_Milliseconds(200)}this.Wall().Layout().Refresh()}))}Model(){return this.model()}Wall(){return this.Parent()}Has_Bar(){return this.Has_Child(0)&&this.Child(0)instanceof Bar.Instance}Bar(){return Utils.Assert(this.Has_Bar(),"Does not have a bar."),this.Child(0)}Has_View(){return this.Has_Child(1)&&this.Child(1)instanceof this.Model().Program().View_Class()}View(){return Utils.Assert(this.Has_View(),"Does not have a view."),this.Child(1)}}