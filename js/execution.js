var __awaiter=this&&this.__awaiter||function(e,i,t,s){return new(t||(t=Promise))((function(n,u){function a(e){try{c(s.next(e))}catch(e){u(e)}}function o(e){try{c(s.throw(e))}catch(e){u(e)}}function c(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(a,o)}c((s=s.apply(e,i||[])).next())}))};import*as Utils from"./utils.js";import*as Queue from"./queue.js";export var Type;!function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.QUEUED=1]="QUEUED",e[e.EXCLUSIVE=2]="EXCLUSIVE"}(Type||(Type={}));export class Frame{constructor(){this.immediate_count=0,this.queued=new Queue.Instance,this.has_exclusive=!1}Execute(e,i){return __awaiter(this,void 0,void 0,(function*(){if(e===Type.IMMEDIATE){for(;!0===this.has_exclusive;)yield Utils.Wait_Milliseconds(1);this.immediate_count+=1,yield i(),this.immediate_count-=1}else if(e===Type.QUEUED){for(;!0===this.has_exclusive;)yield Utils.Wait_Milliseconds(1);yield this.queued.Enqueue(i)}else e===Type.EXCLUSIVE?!1===this.has_exclusive&&(this.has_exclusive=!0,yield Promise.all([function(){return __awaiter(this,void 0,void 0,(function*(){for(;this.immediate_count>0;)yield Utils.Wait_Milliseconds(1)}))}.bind(this)(),this.queued.Pause()]),yield i(),this.queued.Unpause(),this.has_exclusive=!1):Utils.Assert(!1,"Unknown type.")}))}}