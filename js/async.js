var Status,__awaiter=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,d){function a(e){try{o(n.next(e))}catch(e){d(e)}}function r(e){try{o(n.throw(e))}catch(e){d(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,r)}o((n=n.apply(e,t||[])).next())}))};import*as Utils from"./utils.js";!function(e){e[e._NONE_=0]="_NONE_",e[e.READY=1]="READY",e[e.READYING=2]="READYING"}(Status||(Status={}));export class Instance{constructor(){this.status=Status._NONE_,this.dependencies=[]}Add_Dependencies(e){0,0;for(const t of e)0,this.Dependencies().push(t)}Is_Ready(){return(this.status&Status.READY)>0}Toggle_Ready(){this.status^=Status.READY}Is_Readying(){return(this.status&Status.READYING)>0}Toggle_Readying(){this.status^=Status.READYING}Dependencies(){return 0,this.dependencies}Before_Dependencies_Are_Ready(){return __awaiter(this,void 0,void 0,(function*(){0}))}After_Dependencies_Are_Ready(){return __awaiter(this,void 0,void 0,(function*(){0}))}Ready(){return __awaiter(this,void 0,void 0,(function*(){if(this.Is_Readying())for(;this.Is_Readying();)yield Utils.Wait_Milliseconds(1);else this.Is_Ready()||(this.Toggle_Readying(),Object.getPrototypeOf(this).Before_Dependencies_Are_Ready!==Instance.prototype.Before_Dependencies_Are_Ready&&(yield this.Before_Dependencies_Are_Ready()),this.Dependencies().length>0&&(yield Promise.all(this.Dependencies().map((function(e){return e.Ready()})))),this.dependencies=null,Object.getPrototypeOf(this).After_Dependencies_Are_Ready!==Instance.prototype.After_Dependencies_Are_Ready&&(yield this.After_Dependencies_Are_Ready()),this.Toggle_Ready(),this.Toggle_Readying())}))}}